<!-- Template for workouts page -->
{% extends "layout.html" %} <!--This page's content extends from the placeholder defined in layout.html-->

<!--Specify the page title to be shown in the browser tab-->
{% block title %}
    Workouts
{% endblock %}

{% block main %}
    <h4 class="text-center">Add Set</h4>
    <form action="/workouts" method="post" class="mb-5 form-container position-relative">
        <!-- Exercise Autocomplete Dropdown -->
        <div class="mb-3 position-relative">
            <label for="exerciseInput" class="form-label">Exercise</label>
            <input type="text" id="exerciseInput" name="exercise" class="form-control" autocomplete="off">
            <ul id="exerciseSuggestions" class="list-group position-absolute mt-1" style="display: none; width: 100%; z-index: 1000;"></ul>
        </div>

        <div class="mb-3">
            <label for="weight" class="form-label">Weight ({{ current_user.sets_unit }})</label> <!-- Include user's sets_unit in label -->
            <input autocomplete="off" id="weight" class="form-control" name="weight"  type="text">
        </div>
        <div class="mb-3">
            <label for="reps" class="form-label">Reps</label>
            <input autocomplete="off" id="reps" class="form-control" name="reps"  type="text">
        </div>
        <div class="mb-3">
            <label for="date" class="form-label">Date</label>
            <input type="date" name="date" id="date" value="{{ current_date }}" class="form-control">
        </div>
        <button type="submit" class="btn btn-primary w-100" name="add_set">Add</button>
    </form>


    <!-- Javascript for exercise autocomplete dropdown -->
    <script>
        const exercises = {{ exercises | tojson }};
    
        $(document).ready(function() {
            $("#exerciseInput").on("input", function() {
                let query = $(this).val().toLowerCase();
                let matches = exercises.filter(ex => ex.toLowerCase().includes(query));
                
                if (matches.length) {
                    let suggestionsHtml = matches.map(ex => `<li class="list-group-item list-group-item-action">${ex}</li>`).join("");
                    $("#exerciseSuggestions").html(suggestionsHtml).show();
                } else {
                    $("#exerciseSuggestions").hide();
                }
            });
    
            $(document).on("click", "#exerciseSuggestions li", function() {
                $("#exerciseInput").val($(this).text());
                $("#exerciseSuggestions").hide();
            });
    
            $(document).click(function(event) {
                if (!$(event.target).closest("#exerciseInput, #exerciseSuggestions").length) {
                    $("#exerciseSuggestions").hide();
                }
            });
        });
    </script>


    <h4 class="text-cente mt-5">Workout history</h4>
    <form action="/workouts" method="post" class="form-container position-relative">
        <!-- Exercise Autocomplete Dropdown -->
        <div class="mb-3 position-relative">
            <label for="exerciseCategoryInput" class="form-label">Exercise / Category </label>
            <input type="text" id="exerciseCategoryInput"  value="{{ filter['exercise_or_category'] }}" name="exercisecategory" class="form-control" autocomplete="off">
            <ul id="exerciseCategorySuggestions" class="list-group position-absolute mt-1" style="display: none; width: 100%; z-index: 1000;"></ul>
        </div>
        <div class="d-flex gap-3 mb-3">
            <div class="w-50">
                <label for="date" class="form-label">Date</label>
                <input type="date" name="start_date" id="start_date" value="{{ filter['start_date'] }}" class="form-control">
            </div>
            <div class="w-50">
                <label for="date" class="form-label">Date</label>
                <input type="date" name="end_date" id="end_date" value="{{ filter['end_date'] }}" class="form-control">
            </div>
        </div>
        <button type="submit" class="btn btn-primary w-100" name="workouts">Add</button>
    </form>

    <!-- Javascript for exercise / category autocomplete dropdown -->
    <script>
        const exercises_and_categories = {{ exercises_and_categories | tojson }};
    
        $(document).ready(function() {
            $("#exerciseCategoryInput").on("input", function() {
                let query = $(this).val().toLowerCase();
                let matches = exercises_and_categories.filter(ex => ex.toLowerCase().includes(query));
                
                if (matches.length) {
                    let suggestionsHtml = matches.map(ex => `<li class="list-group-item list-group-item-action">${ex}</li>`).join("");
                    $("#exerciseCategorySuggestions").html(suggestionsHtml).show();
                } else {
                    $("#exerciseCategorySuggestions").hide();
                }
            });
    
            $(document).on("click", "#exerciseCategorySuggestions li", function() {
                $("#exerciseCategoryInput").val($(this).text());
                $("#exerciseCategorySuggestions").hide();
            });
    
            $(document).click(function(event) {
                if (!$(event.target).closest("#exerciseCategoryInput, #exerciseCategorySuggestions").length) {
                    $("#exerciseCategorySuggestions").hide();
                }
            });
        });
    </script>
{% endblock %}

